"use strict";function load(t,a=""){return loadItem(namespace,t,a)}function save(t,a){saveItem(namespace,t,a)}function addIcon(){clearIcon(),watch=load("watch",def),bgOpacity=load("bgOpacity","0.5");for(let t=0;t<party.length;t++){$(`tr:eq(${t})`).css("background-color",`rgba(0,0,0,${bgOpacity}`);for(let a=0;a<10;a++)try{if(watchingID[t][a]=watch[party[t].job][a],""!==watchingID[t][a]){watchingRecast[t][a]=action[party[t].job][watchingID[t][a]][5];let e=$(`tr:eq(${t})`).children()[a];if($(e).css("background-image",`url(https://cafemaker.wakingsands.com/i/${action[party[t].job][watch[party[t].job][a]][1]})`),99!==maxSync){let r=action[party[t].job][watch[party[t].job][a]][3];r<=minSync?$(e).css("opacity","1"):minSync<r&&r<=maxSync&&80!=minSync&&($(e).append($("<article></article>").text("?")),$(e).css("opacity","0.8"))}}}catch(t){console.log(t)}}}function clearIcon(){if($("tr").css("background-color",""),$("td").css("background-image",""),$("td").css("opacity","0.2"),$("td").text(""),timerList)for(const t of timerList)clearInterval(t)}function checkWatch(t){t:for(let a=0;a<party.length;a++){const e=party[a];if(e.id===extractLog(t.line,"CasterObjectID"))for(let e=0;e<watchingID[a].length;e++){let r=parseInt(extractLog(t.line,"AbilityID"),16);for(const t in compareSameGroup)if(Object.hasOwnProperty.call(compareSameGroup,t)){const a=compareSameGroup[t];r===a[0]&&(r=a[1])}if(parseInt(watchingID[a][e])===r){let r=$(`tr:eq(${a})`).children()[e];if($(r).text()>0)break t;let o=watchingRecast[a][e]/10;$(r).css("opacity","1"),$(r).empty(),$(r).append($("<article></article>").text(o--)),$($(r).children()[0]).css("background-color","rgba(27,27,27,0.5)"),$(r).css("background-image",`url(https://cafemaker.wakingsands.com/i/${action[party[a].job][parseInt(extractLog(t.line,"AbilityID"),16)][1]})`);let c=setInterval(()=>{$($(r).children()[0]).text(o--),o>=0||(clearInterval(c),$($(r).children()[0]).css("background-color",""),$(r).text(""),$(r).css("background-image",`url(https://cafemaker.wakingsands.com/i/${action[party[a].job][watch[party[a].job][e]][1]})`))},1e3);timerList.push(c);break t}}}}import{checkLog,extractLog}from"../../resources/logLineProcessing.min.js";import{partySort}from"../../resources/partyList.min.js";import{action}from"../../resources/action.min.js";import{zoneInfoType}from"../../resources/zoneInfo.min.js";import{quest}from"../../resources/quest.min.js";import{compareSameGroup}from"./compareSameGroup.min.js";import{def,defSort}from"./def.js";import{loadItem,saveItem}from"../../resources/localStorage.min.js";let namespace="teamWatch",charID="",party=[],watchingID=Array(8),watchingRecast=Array(8);for(let t=0;t<8;t++)watchingID[t]=["","","","","","","","","",""],watchingRecast[t]=[0,0,0,0,0,0,0,0,0,0];let bgOpacity,sortRule,minSync=1,maxSync=99,watch={},timerList=[];$("table").css("border-spacing","3px 5px"),$("td").css("width","30px"),$("td").css("height","30px"),document.addEventListener("onOverlayStateUpdate",t=>{t.detail.isLocked?($("#readMe").hide(),$("body").css("background-color","rgba(0,0,150,0.0)")):($("#readMe").show(),$("body").css("background-color","rgba(0,0,150,0.2)"))}),addOverlayListener("LogLine",t=>{(checkLog(t.line,"15",{})||checkLog(t.line,"16",{}))&&checkWatch(t)}),addOverlayListener("onPartyWipe",()=>addIcon()),addOverlayListener("ChangePrimaryPlayer",t=>{charID=t.charID}),addOverlayListener("ChangeZone",t=>{try{minSync=quest[zoneInfoType[t.zoneID].name.cn][0],maxSync=quest[zoneInfoType[t.zoneID].name.cn][1]}catch{minSync=1,maxSync=99}}),addOverlayListener("PartyChanged",t=>{sortRule=load("sortRule",defSort),t.party&&(party=partySort(t.party,charID,sortRule)),setTimeout(()=>{addIcon()},1e3)}),startOverlayEvents(),window.settingWatch=function(){window.open("./settingWatch.html","_blank","width=411,height=467")},window.makeFakeParty=function(){party=[{id:"1039CE69",name:"Souma",worldId:1177,job:38,inParty:!0},{id:"10000002",name:"酱",worldId:1169,job:19,inParty:!0},{id:"10000003",name:"良",worldId:1169,job:30,inParty:!0},{id:"10000004",name:"游",worldId:1179,job:28,inParty:!0},{id:"10000005",name:"L",worldId:1043,job:22,inParty:!0},{id:"10000006",name:"天",worldId:1045,job:20,inParty:!0},{id:"100000007",name:"Ta",worldId:1179,job:33,inParty:!0},{id:"10000008",name:"So",worldId:1177,job:25,inParty:!0}],sortRule=load("sortRule",defSort),party=partySort(party,272223849,sortRule),minSync=999,maxSync=999,addIcon()},window.clearShow=function(){party=[],clearIcon()};