"use strict";function checkWatch(a){try{a:for(let e=0;e<party.length;e++){const t=party[e];if(t.id===extractLog(a.line,"CasterObjectID"))for(let t=0;t<watchingID[e].length;t++){let r=parseInt(extractLog(a.line,"AbilityID"),16);for(const a in compareSameGroup)if(Object.hasOwnProperty.call(compareSameGroup,a)){const e=compareSameGroup[a];r===e[0]&&(r=e[1])}if(parseInt(watchingID[e][t])===r){let r=$(`tr:eq(${e})`).children()[t];if($(r).text()>0)break a;let c=watchingRecast[e][t]/10;$(r).css("opacity","1"),$(r).css("border",""),$(r).empty(),$(r).append($("<article></article>").text(c--)),$($(r).children()[0]).css("background-color","rgba(27,27,27,0.5)"),$(r).css("background-image",`url(https://cafemaker.wakingsands.com/i/${action[party[e].job][parseInt(extractLog(a.line,"AbilityID"),16)][1]})`);let o=setInterval(()=>{$($(r).children()[0]).text(c--),(-1===c||flagFinish)&&(clearInterval(o),$($(r).children()[0]).css("background-color",""),$(r).text(""),$(r).css("background-image",`url(https://cafemaker.wakingsands.com/i/${action[party[e].job][watch[party[e].job][9-t]][1]})`))},1e3);break a}}}}catch{}}function addIcon(){try{clearIcon();for(let a=0;a<8;a++)if(a<party.length){$(`tr:eq(${a})`).css("background-color","rgba(0,0,0,0.5)");for(let e=0;e<10;e++)try{watchingID[a][e]=watch[party[a].job][9-e],watchingRecast[a][e]=action[party[a].job][watch[party[a].job][9-e]][5],$($($("tbody").children()[a]).children()[e]).css("background-image",`url(https://cafemaker.wakingsands.com/i/${action[party[a].job][watch[party[a].job][9-e]][1]})`);let t=action[party[a].job][watch[party[a].job][9-e]][3],r=$($("tbody").children()[a]).children()[e];99!==maxSync&&(t<=minSync?$(r).css("opacity","1"):minSync<t&&t<=maxSync&&80!=minSync&&($(r).append($("<article></article>").text("?")),$(r).css("opacity","0.8")))}catch{}}}catch{}}function clearIcon(){$("tr").css("background-color",""),$("td").css("background-image",""),$("td").css("opacity","0.2"),$("td").text("")}import{checkLog,Comparison,extractLog}from"../../resources/logLineProcessing.min.js";import{partySort}from"../../resources/partyList.min.js";import{action}from"../../resources/action.min.js";import{quest}from"../../resources/quest.min.js";let charID,party,sortRuleAll,rangeSize=30,spacingHorizontal=3,spacingVertical=5,watchingID=Array(8),watchingRecast=Array(8);for(let a=0;a<8;a++)watchingID[a]=["","","","","","","","","",""],watchingRecast[a]=[0,0,0,0,0,0,0,0,0,0];let watch,minSync=1,maxSync=99,flagFinish=!1;watch=null==localStorage.getItem("setWatch")?{1:["","","","","","","7535","7548","7533",""],2:["","","","","","","7549","7542","7541",""],3:["","","","","","","7535","7548","7533",""],4:["","","","","","","7549","7542","7541",""],5:["","","","","","","","","",""],6:["","","","","","","","","",""],7:["","","","","","","7560","","157",""],19:["20","7383","7531","17","3540","7385","7535","7548","7533","30"],20:["7395","","","","","65","7549","7542","7541","7396"],21:["7389","16464","7531","44","3552","7388","7535","7548","7533","43"],22:["85","","","","","","7549","7542","7541","3557"],23:["101","","","","","","7405","","7541","118"],24:["7432","3570","3571","7433","3569","","16536","7562","7561","140"],25:["3573","","","","","","7560","","157",""],26:["","","","","","","7560","","157",""],27:["3581","7427","","","","","7560","","7561","7423"],28:["166","188","3583","16542","16537","7434","16545","7562","7561","7436"],29:["","","","","","","7549","7542","7541",""],30:["2257","","","","","","7549","7542","7541","2258"],31:["2878","","","","","","16889","","7541",""],32:["7390","7393","7531","3636","3634","16471","7535","7548","7533","3638"],33:["16556","7439","16557","16553","3613","","16559","7562","7561","16552"],34:["16486","7499","","","","","7549","7542","7541",""],35:["7521","","","","","","7560","","7561","7520"],36:["11415","11411","11421","23280","23273","18320","7560","18305","7561","18317"],37:["16138","16161","7531","16148","16151","16160","7535","7548","7533","16152"],38:["16013","15998","","","","16015","16012","","7541",""]}:JSON.parse(localStorage.getItem("setWatch"));let compareSameGroup=[[16484,16486],[16485,16486],[16191,16192],[15998,0],[16193,15998],[16194,15998],[16195,15998],[16196,15998],[3551,16464]];document.addEventListener("onOverlayStateUpdate",a=>{a.detail.isLocked?($("#readMe").hide(),$("body").css("background-color","rgba(0,0,150,0.0)")):($("#readMe").show(),$("body").css("background-color","rgba(0,0,150,0.2)"))}),$("table").css("border-spacing",`${spacingHorizontal}px ${spacingVertical}px`),$("td").css("width",`${rangeSize}px`),$("td").css("height",`${rangeSize}px`),addOverlayListener("LogLine",a=>{checkLog(a.line,"00",{MessageType:[Comparison.equal,"0839"],MessageText:[Comparison.matchRegex,"^.+(任务结束了。| has ended.|」の攻略を終了した。)$"]})||checkLog(a.line,"00",{MessageType:[Comparison.equal,"0039"],MessageText:[Comparison.matchRegex,"^进入了休息区。|You have entered a sanctuary.|レストエリアに入った！$"]})?(clearIcon(),flagFinish=!0,setTimeout(()=>{flagFinish=!1},1e3)):checkLog(a.line,"21",{Command:[Comparison.equal,"40000001"]})||checkLog(a.line,"21",{Command:[Comparison.equal,"40000006"]})||checkLog(a.line,"21",{Command:[Comparison.equal,"40000010"]})?addIcon():(checkLog(a.line,"15",{})||checkLog(a.line,"16",{}))&&checkWatch(a)}),addOverlayListener("ChangePrimaryPlayer",a=>{charID=a.charID}),addOverlayListener("ChangeZone",a=>{try{null==quest[a.zoneName]?(minSync=1,maxSync=99):(minSync=quest[a.zoneName][0],maxSync=quest[a.zoneName][1])}catch{minSync=1,maxSync=99}}),addOverlayListener("PartyChanged",a=>{try{party=partySort(a.party,charID,sortRuleAll)}catch{}}),startOverlayEvents(),sortRuleAll=null==localStorage.getItem("setSortRule")?[21,32,37,19,24,33,28,22,20,34,30,25,27,36,35,23,31,38]:JSON.parse(localStorage.getItem("setSortRule")),setTimeout(()=>{addIcon()},1e3),window.settingSort=function(){window.open("./settingSort.html","_self")},window.settingWatch=function(){window.open("./settingWatch.html","_blank","width=200,height=300")},window.showFakeParty=function(){party=[{id:"1039CE69",name:"Souma",worldId:1177,job:34,inParty:!0},{id:"10000002",name:"酱",worldId:1169,job:19,inParty:!0},{id:"10000003",name:"良",worldId:1169,job:30,inParty:!0},{id:"10000004",name:"游",worldId:1179,job:28,inParty:!0},{id:"10000005",name:"L",worldId:1043,job:22,inParty:!0},{id:"10000006",name:"天",worldId:1045,job:20,inParty:!1},{id:"100000007",name:"Ta",worldId:1179,job:33,inParty:!0},{id:"10000008",name:"So",worldId:1177,job:25,inParty:!0}],party=partySort(party,charID,sortRuleAll),minSync=999,maxSync=999,addIcon()},window.clearShow=function(){party=[],clearIcon()},window.userRefresh=function(){party&&(party=partySort(party,charID,sortRuleAll),addIcon())};