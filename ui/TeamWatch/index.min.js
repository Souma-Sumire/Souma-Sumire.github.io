"use strict";function load(t,e=""){return loadItem(namespace,t,e)}function loadTable(){function t(t){return t<=sync[0]?1:sync[0]<t&&t<=sync[1]?.6:.2}$("table").remove();let e=$(`<table><tbody>${party.map(e=>`<tr id="${e.job}">${watch[e.job].map(a=>`<td>${a>0?`<div class="icon" style="opacity:${t(action[e.job][a][3])};background-image:url(https://cafemaker.wakingsands.com/i/${action[e.job][a][1]})"></div><article title="${action[e.job][a][5]/10}"></article>`:""}</td>`).join("")}</tr>`).join("")}</tbody></table>`);$("main").append(e),$(".icon").css({position:"absolute",height:settings.iconSize+"px",width:settings.iconSize+"px",top:-settings.spacingY+"px","line-height":settings.iconSize+"px"}),$("body > main > table > tbody > tr > td").css({position:"relative",height:settings.iconSize+"px",width:settings.iconSize+"px"}),$("body > main > table > tbody > tr > td > article").css({position:"absolute","line-height":settings.iconSize+"px",width:settings.iconSize+"px",top:-settings.spacingY+"px",fontSize:settings.fontSize+"px"}),$("body > main > table").css({"border-spacing":`${settings.spacingX}px ${settings.spacingY}px`,"background-color":`rgba(0, 0, 0, ${settings.bgOpacity})`,padding:settings.tablePadding+"px"}),$("body > main > table > tbody > tr:last-child > td").css("height",parseInt(settings.iconSize-2*settings.spacingY)+"px"),$("main").css({"min-width":10*settings.iconSize+11*settings.spacingX+2*settings.tablePadding+"px","max-width":10*settings.iconSize+11*settings.spacingX+2*settings.tablePadding+"px"})}import{partySort}from"../../resources/partyList.min.js";import{action}from"../../resources/action.min.js";import{compareSame}from"./compareSameGroup.min.js";import{def,defSort,defSets}from"./def.min.js";import{loadItem}from"../../resources/localStorage.min.js";import{zoneSync}from"../../resources/sync.js";let charID,party=[],intervals=[],namespace="teamWatch",watch=load("watch",JSON.parse(JSON.stringify(def))),sync=[0,999],settings=load("settings",JSON.parse(JSON.stringify(defSets))),r=document.querySelectorAll("#readMe > p.clickable");r[0].addEventListener("click",()=>{window.open("./settingWatch.html","_blank","width=411,height=542")}),r[1].addEventListener("click",()=>{party=[{id:"10000027",name:"PLD",worldId:1177,job:19,inParty:!0},{id:"10000030",name:"NIN",worldId:1169,job:30,inParty:!0},{id:"10000028",name:"SCH",worldId:1179,job:28,inParty:!0},{id:"10000022",name:"DRG",worldId:1043,job:22,inParty:!0},{id:charID.toString(16).toUpperCase(),name:"TEST",worldId:1177,job:21,inParty:!0},{id:"10000020",name:"MNK",worldId:1045,job:20,inParty:!0},{id:"10000033",name:"AST",worldId:1179,job:33,inParty:!0},{id:"10000025",name:"BLM",worldId:1177,job:25,inParty:!0}],party=partySort(party,charID,load("sortRule",JSON.parse(JSON.stringify(defSort)))),watch=load("watch",JSON.parse(JSON.stringify(def))),sync=[999,999],loadTable()}),r[2].addEventListener("click",()=>{party=[];for(const t of intervals)clearInterval(t);$("table").remove()}),document.addEventListener("onOverlayStateUpdate",t=>t.detail.isLocked?$("#readMe").hide():$("#readMe").show()),addOverlayListener("onPartyWipe",()=>{for(const t of intervals)clearInterval(t);loadTable()}),addOverlayListener("ChangePrimaryPlayer",t=>charID=t.charID),addOverlayListener("PartyChanged",t=>{party=partySort(t.party,charID,load("sortRule",JSON.parse(JSON.stringify(defSort))));for(const t of intervals)clearInterval(t);setTimeout(()=>loadTable(),1e3)}),addOverlayListener("ChangeZone",t=>{sync=zoneSync[t.zoneName]||[0,999]}),addOverlayListener("onLogEvent",t=>{let e=t.detail.logs,a=/^.{15}1[56]:(?<CasterObjectID>1.{7}):[^:]+:(?<AbilityID>[^:]+):/i;for(const t of e){let e=t.match(a);if(e){let t=party.findIndex(t=>t.id===e.groups.CasterObjectID);if(t+1){let a=compareSame(e.groups.AbilityID),i=watch[party[t].job].findIndex(t=>parseInt(t)===a);if(i+1){let n=$("main>table>tbody>tr").eq(t).children()[i],r=$(n).children("div")[0];$(r).css({opacity:1,"background-image":`url(https://cafemaker.wakingsands.com/i/${action[party[t].job][parseInt(e.groups.AbilityID,16)][1]})`});let s=$(n).children("article")[0],o=s.title;$(s).text(o--),$(s).css("background-color","rgba(27,27,27,0.5)");let d=setInterval(()=>{$(s).text(o),o--||($(s).text(""),$(s).css("background-color",""),$(r).css("background-image",`url(https://cafemaker.wakingsands.com/i/${action[party[t].job][a][1]})`),clearInterval(d))},1e3);intervals.push(d)}}}}}),startOverlayEvents();