"use strict";function load(t,e=""){return loadItem(namespace,t,e)}function loadTable(){function t(t){return t<=sync[0]?1:sync[0]<t&&t<=sync[1]?.6:.2}let e=load("settings",JSON.parse(JSON.stringify(defCSS)));$("body > main > table").remove();let a=$(`<table><tbody>${party.map(e=>`<tr id="${e.job}">${watch[e.job].map(a=>`<td>${a>0?`<div class="icon" style="opacity:${t(action[e.job][a][3])};background-image:url(https://cafemaker.wakingsands.com/i/${action[e.job][a][1]})"></div><article title="${action[e.job][a][5]/10}"></article>`:""}</td>`).join("")}</tr>`).join("")}</tbody></table>`);$("body > main").append(a),$(".icon").css({position:"absolute",height:e.iconSize+"px",width:e.iconSize+"px",top:-e.spacingY+"px","line-height":e.iconSize+"px"}),$("body > main > table > tbody > tr > td").css({position:"relative",height:e.iconSize+"px",width:e.iconSize+"px"}),$("body > main > table > tbody > tr > td > article").css({position:"absolute","line-height":e.iconSize+"px",width:e.iconSize+"px",top:-e.spacingY+"px",fontSize:e.fontSize+"px"}),$("body > main > table").css({"border-spacing":`${e.spacingX}px ${e.spacingY}px`,"background-color":`rgba(0, 0, 0, ${e.bgOpacity})`,padding:party.length?e.tablePadding:"0px"}),$("body > main > table > tbody > tr:last-child > td").css("height",parseInt(e.iconSize-2*e.spacingY)+"px"),$("body > main").css({"min-width":10*e.iconSize+11*e.spacingX+2*e.tablePadding+"px","max-width":10*e.iconSize+11*e.spacingX+2*e.tablePadding+"px"})}import{action}from"../../resources/action.min.js";import{loadItem}from"../../resources/localStorage.min.js";import{partySort}from"../../resources/partyList.min.js";import{zoneSync}from"../../resources/sync.js";import{compareSame}from"./compareSameGroup.min.js";import{def,defCSS,defSort}from"./def.min.js";let charID,party=[],intervals=[],namespace="teamWatch",watch=load("watch",JSON.parse(JSON.stringify(def))),sync=[0,999],r=document.querySelectorAll("#readMe > p.clickable");r[0].addEventListener("click",()=>{window.open("./settingWatch.html","_blank","width=411,height=542")}),r[1].addEventListener("click",()=>{party=[{id:"10000027",name:"PLD",worldId:1177,job:19,inParty:!0},{id:"10000030",name:"NIN",worldId:1169,job:30,inParty:!0},{id:"10000028",name:"SCH",worldId:1179,job:28,inParty:!0},{id:"10000022",name:"DRG",worldId:1043,job:22,inParty:!0},{id:(charID||"10000021").toString(16).toUpperCase(),name:"TEST",worldId:1177,job:21,inParty:!0},{id:"10000020",name:"MNK",worldId:1045,job:20,inParty:!0},{id:"10000033",name:"AST",worldId:1179,job:33,inParty:!0},{id:"10000025",name:"BLM",worldId:1177,job:25,inParty:!0}],party=partySort(party,charID,load("sortRule",JSON.parse(JSON.stringify(defSort)))),watch=load("watch",JSON.parse(JSON.stringify(def))),sync=[999,999],loadTable()}),r[2].addEventListener("click",()=>{party=[];for(const t of intervals)clearInterval(t);$("body > main > table").remove()}),document.addEventListener("onOverlayStateUpdate",t=>t.detail.isLocked?$("#readMe").hide():$("#readMe").show()),addOverlayListener("ChangePrimaryPlayer",t=>charID=t.charID),addOverlayListener("PartyChanged",t=>{party=partySort(t.party,charID,load("sortRule",JSON.parse(JSON.stringify(defSort))));for(const t of intervals)clearInterval(t);setTimeout(()=>loadTable(),1e3)}),addOverlayListener("ChangeZone",t=>{sync=zoneSync[t.zoneName]||[0,999]}),addOverlayListener("onPartyWipe",()=>{for(const t of intervals)clearInterval(t);$("body > main > table > tbody > tr > td > article").text("")}),addOverlayListener("onLogEvent",t=>{let e=t.detail.logs;for(const t of e){let e=t.match(/^.{15}1[56]:(?<CasterObjectID>1.{7}):[^:]+:(?<AbilityID>[^:]+):/i);if(e){let t=party.findIndex(t=>t.id===e.groups.CasterObjectID);if(t+1){let a=compareSame(e.groups.AbilityID),i=watch[party[t].job].findIndex(t=>parseInt(t)===a);if(i+1){let r=$("body > main > table > tbody > tr").eq(t).children()[i],o=$(r).children("div")[0];$(o).css({opacity:1,"background-image":`url(https://cafemaker.wakingsands.com/i/${action[party[t].job][parseInt(e.groups.AbilityID,16)][1]})`});let n=$(r).children("article")[0],d=n.title;$(n).text(d--),$(n).css("background-color","rgba(27,27,27,0.5)");let c=setInterval(()=>{$(n).text(d),d--||($(n).text(""),$(n).css("background-color",""),$(o).css("background-image",`url(https://cafemaker.wakingsands.com/i/${action[party[t].job][a][1]})`),clearInterval(c))},1e3);intervals.push(c)}}}}}),startOverlayEvents();