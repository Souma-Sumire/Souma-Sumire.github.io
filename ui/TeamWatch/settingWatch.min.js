"use strict";function load(t,e=""){return loadItem(namespace,t,e)}function save(t,e){saveItem(namespace,t,e)}function insertJobList(){let t=19;for(const e of sortRule)if(jobList[e][1]){t=parseInt(e);break}for(const e in jobList)if(Object.hasOwnProperty.call(jobList,e)){const a=jobList[e];a[1]&&$("#job").append(`<option value="${e}" ${parseInt(e)===t?"selected":""}>${a[0]}</option>`)}job=$("#job").val(),insertSelect()}function insertSelect(){$("select.skill").children().remove();for(let t=0;t<10;t++){$("select.skill").eq(t).append('<option value=""></option>');for(const e in action[job])if(Object.hasOwnProperty.call(action[job],e)&&(void 0===compareSameGroup[e]||"15998"===e)&&(shortGCD||action[job][e][5]>=100)){let a=!1;for(const t of $(`#${job}>td>span`))$(t).text()===e&&(a=!0);$("select.skill").eq(t).append(`<option ${a?'class="owned"':""} value="${e}">${action[job][e][0]}</option>`)}$("select.skill").eq(t).val(watch[job][t])}}function getWatch(){let t={};for(const e in jobList){let a=[];if(Object.hasOwnProperty.call(jobList,e)){for(let t=0;t<10;t++)a.push($(`#${e} span`).eq(t).text());t[e]=JSON.parse(JSON.stringify(a))}}return t}function show(t){$("#pre").html("");for(let e=0;e<sortRule.length;e++){const a=sortRule[e];try{$("#pre").append(`<tr id="${a}" ${jobList[a][1]?"":"hidden"}><td class="${classColor(a)} pre-job">${jobList[a][0]}</td>${`${t[a].map(t=>t?`<td style="background-image:url(https://cafemaker.wakingsands.com/i/${action[a][t][1]})"><span style="display:none">${t}</span></td>`:"<td><span></span></td>")}`}</tr>`)}catch{console.log(jobList[a][0]+"意外错误，已跳过。")}}$("tr").on("click",t=>{job=t.currentTarget.id,$("#job").val(job),insertSelect()}),$("td").on("click",t=>{let e=t.currentTarget.cellIndex;e>0&&(e--,$(".skill").eq(e).css("backgroundColor","lightPink"),setTimeout(()=>{$(".skill").eq(e).css("backgroundColor","")},500))}),$("#pre>tr").arrangeable({dragSelector:"td:first"}),$("#bgOpacity").val(bgOpacity),$("#text").text($("#bgOpacity").val()),$("#pre>tr").css("background-color",`rgba(0,0,0,${bgOpacity})`)}function classColor(t){switch(parseInt(t)){case 1:case 3:case 21:case 32:case 37:case 19:return"tank";case 6:case 24:case 33:case 28:return"healer";default:return"dps"}}function rev(t){for(const e in t)if(Object.hasOwnProperty.call(t,e)){const a=t[e];a.reverse()}return t}import{action}from"../../resources/action.min.js";import{def,defSort}from"./def.js";import{compareSameGroup}from"./compareSameGroup.min.js";import{loadItem,saveItem}from"../../resources/localStorage.min.js";import"../../resources/drag-arrange.js";let watch,namespace="teamWatch";try{watch=load("watch",JSON.parse(JSON.stringify(def)))}catch{console.log("配置格式错误，已恢复默认。"),watch=JSON.parse(JSON.stringify(def)),save("watch",watch)}let shortGCD=!1,jobList={1:["剑术师",!1],2:["格斗家",!1],3:["斧术师",!1],4:["枪术士",!1],5:["弓箭手",!1],6:["幻术师",!1],7:["咒术师",!1],19:["骑士",!0],20:["武僧",!0],21:["战士",!0],22:["龙骑士",!0],23:["吟游诗人",!0],24:["白魔法师",!0],25:["黑魔法师",!0],26:["秘术师",!1],27:["召唤师",!0],28:["学者",!0],29:["双剑师",!1],30:["忍者",!0],31:["机工士",!0],32:["暗黑骑士",!0],33:["占星术士",!0],34:["武士",!0],35:["赤魔法师",!0],36:["青魔法师",!0],37:["绝枪战士",!0],38:["舞者",!0]},sortRule=load("sortRule",JSON.parse(JSON.stringify(defSort))),job=19,bgOpacity=load("bgOpacity","0.5");window.onload=function(){insertJobList()},window.checkboxOnClick=function(t){shortGCD=$(t).prop("checked"),insertSelect()},$("#job").on("change",function(){job=$("#job").val(),insertSelect()}),$(".skill").on("change",t=>{watch[$("#job").val()][$(t.currentTarget).parent().index()]=$(t.currentTarget).val(),show(watch)}),$("#set-save").on("click",()=>{save("bgOpacity",$("#bgOpacity").val());let t=[];for(let e=0;e<$("#pre>tr").length;e++)t.push($("#pre>tr").eq(e)[0].id);watch=JSON.parse(JSON.stringify(getWatch())),sortRule=JSON.parse(JSON.stringify(t)),save("watch",watch),save("sortRule",sortRule),show(watch)}),$("#set-noSave").on("click",()=>{location.reload()}),$("#set-def").on("click",()=>{sortRule=JSON.parse(JSON.stringify(defSort)),watch=JSON.parse(JSON.stringify(def)),show(watch),insertSelect()}),$("#set-exp").on("click",()=>{$("#area").val(window.btoa(JSON.stringify(getWatch())))}),$("#set-imp").on("click",()=>{let t="在这里输入他人分享的配置，再点导入。";if(""===$("#area").val()||$("#area").val()===t)$("#area").val(t),window.open("https://docs.qq.com/sheet/DTUJuWUprdnVPQlhr?tab=BB08J2","_blank","width=1450,height=800");else try{watch=JSON.parse(atob($("#area").val())),show(watch),insertSelect(),$("#area").val("已导入。")}catch{$("#area").val("读取失败，请检查格式。")}}),show(watch),$("#bgOpacity").on("change",()=>{bgOpacity=$("#bgOpacity").val(),$("#text").text(bgOpacity),$("#pre>tr").css("background-color",`rgba(0,0,0,${bgOpacity})`)}),$("#set-old").on("click",()=>{let t=confirm("要尝试恢复旧版本的配置吗？");if(t){let t=localStorage.getItem("setWatch");t?show(JSON.parse(t)):alert("未找到旧版配置")}}),$("#set-rev").on("click",()=>{watch=rev(watch),insertSelect(),show(watch)});