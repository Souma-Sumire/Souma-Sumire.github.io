"use strict";function load(t,e=""){return loadItem(namespace,t,e)}function save(t,e){saveItem(namespace,t,e)}function insertJobList(){for(const t in jobList)if(Object.hasOwnProperty.call(jobList,t)){const e=jobList[t];$("#job").append(`<option value="${t}" ${19===parseInt(t)?"selected":""}>${e}</option>`)}job=$("#job").val()}function insertSelect(){$("select.skill").children().remove();for(let t=0;t<10;t++){$("select.skill").eq(t).append('<option value=""></option>');t:for(const e in action[job])if(Object.hasOwnProperty.call(action[job],e)){for(const t of compareSameGroup)if(t[0].toString()===e)continue t;(shortGCD||action[job][e][5]>=100)&&$("select.skill").eq(t).append(`<option value="${e}">${action[job][e][0]}</option>`)}$("select.skill").eq(t).val(watch[job][t])}}function show(){$("#pre").html("");for(const t in watch)if(Object.hasOwnProperty.call(watch,t)){const e=watch[t];try{$("#pre").append(`<tr id="${t}"><td class="pre-job">${jobList[t]}</td>${`${e.map(e=>e?`<td style="background-image:url(https://cafemaker.wakingsands.com/i/${action[t][e][1]})"></td>`:"<td></td>")}`}</tr>`)}catch{$("#pre").append(`<tr id="${t}"><td class="pre-job"">${jobList[t]}</td>${`${e.map(t=>t?"<td><img></img></td>":"<td></td>")}`}</tr>`)}}$("tr").on("click",t=>{job=t.currentTarget.id,$("#job").val(job),insertSelect()}),$("td").on("click",t=>{let e=t.currentTarget.cellIndex;e>0&&(e--,$(".skill").eq(e).css("backgroundColor","Red"),setTimeout(()=>{$(".skill").eq(e).css("backgroundColor","")},1e3))})}function insertSort(){$("#s").html("");for(let t=0;t<sortRule.length;t++){const e=parseInt(sortRule[t]);$(o).append(`<option class="jobClass ${classColor(e)}" value="${e}">${sortList[e]}</option>`)}}function classColor(t){switch(t){case 21:case 32:case 37:case 19:return"tank";case 24:case 33:case 28:return"healer";default:return"dps"}}import{action}from"../../resources/action.min.js";import{def,defSort}from"./def.js";import{compareSameGroup}from"./compareSameGroup.min.js";import{loadItem,saveItem}from"../../resources/localStorage.min.js";let watch,namespace="teamWatch";try{watch=load("watch",def)}catch{console.log("配置格式错误，已恢复默认。"),watch=JSON.parse(JSON.stringify(def)),save("watch",watch)}let t,shortGCD=!1,jobList={1:"剑术师",2:"格斗家",3:"斧术师",4:"枪术士",5:"弓箭手",6:"幻术师",7:"咒术师",19:"骑士",20:"武僧",21:"战士",22:"龙骑士",23:"吟游诗人",24:"白魔法师",25:"黑魔法师",26:"秘术师",27:"召唤师",28:"学者",29:"双剑师",30:"忍者",31:"机工士",32:"暗黑骑士",33:"占星术士",34:"武士",35:"赤魔法师",36:"青魔法师",37:"绝枪战士",38:"舞者"},jobNum=18,job=20;window.onload=function(){insertJobList(),insertSelect()},window.checkboxOnclick=function(t){shortGCD=$(t).prop("checked"),insertSelect()},$("#job").on("change",function(){job=$("#job").val(),insertSelect()}),window.save=function(){let t=[];for(let e=0;e<10;e++)t.push($("select.skill").eq(e).val());delete watch[job],watch[job]=t,save("watch",watch),show()},window.rec=function(){insertSelect()},window.def=function(){let t=confirm("确定要全部恢复默认吗？");t&&(watch=JSON.parse(JSON.stringify(def)),show(),insertSelect())},window.exp=function(){$("#area").val(window.btoa(JSON.stringify(watch)))},window.imp=async function(){let e=atob($("#area").val());e&&(show(JSON.parse(e)),t||(t=setTimeout(()=>{let o=confirm("确定要导入此配置吗？");o?(save("watch",e),location.reload()):show(),t=null},500)))},show();let bgOpacity=load("bgOpacity","0.5");$("#bgOpacity").val(bgOpacity),$("#pre").css("background-color",`rgba(50,50,50,${bgOpacity})`),$("#text").text($("#bgOpacity").val()),window.saveOpacity=function(){save("bgOpacity",$("#bgOpacity").val())},$("#bgOpacity").on("change",()=>{bgOpacity=$("#bgOpacity").val(),$("#text").text(bgOpacity),$("#pre").css("background-color",`rgba(50,50,50,${bgOpacity})`)});let sortList={19:"骑士/剑术师",20:"武僧/格斗家",21:"战士/斧术师",22:"龙骑士/枪术士",23:"吟游诗人",24:"白魔法师/幻术师",25:"黑魔法师/咒术师",27:"召唤师/秘术师",28:"学者",30:"忍者/双剑师",31:"机工士",32:"暗黑骑士",33:"占星术士",34:"武士",35:"赤魔法师",36:"青魔法师",37:"绝枪战士",38:"舞者"},o=$(`<select id="s" size="${jobNum}"></select>`),sortRule=load("sortRule",defSort);insertSort(),$("#sort").append(o),$("#sort").append('<button class="save" id="sortSave">保存</button>'),$("#sort").append('<button class="rec" id="sortRec">重做</button>'),$("#sort").append('<p><button class="def" id="sortDef">排序默认值</button></p>'),$("#updown").children().on("click",t=>{let e=$("#s").find("option:selected").index();"up"===t.currentTarget.id?$("#s").children().eq(e).insertBefore($("#s").children().eq(0===e?0:e-1)):$("#s").children().eq(e).insertAfter($("#s").children().eq(e===jobNum?jobNum:e+1))}),$("#sortSave").on("click",()=>{let t=[];for(let e=0;e<jobNum;e++)t.push($("#s").children().eq(e).val());save("sortRule",t)}),$("#sortRec").on("click",()=>{insertSort()}),$("#sortDef").on("click",()=>{let t=confirm("确定要恢复默认排序吗？");t&&(sortRule=defSort,insertSort())});