"use strict";function inparty(e){for(const s of party)if(s.id===e)return!0;return!1}function wipe(){gainsBuffs={},$("main>div").children().remove()}function handle(e){function s(e,s){let i=getDamage(e.line);if(e.line[6]===e.line[2]&&("damage"===i.type||"other"===i.type)&&parseInt("20F7785",16)>1e5)return;let a=$(`<div class="list ${$(`#${i.type}${s?"Party":""}`).children().length%2?"odd":"even"}">${"heal"===i.type?`<img src="https://cafemaker.wakingsands.com/i/${justGiveMe(parseInt(i.skillID,16))[1]}">`:""}<div class="list-text ${i.damageType}">${duration} ${i.skillName} ${(i.value/1e4).toFixed(2)}万 ${i.damageEffect} (${e.line[24]}/${e.line[25]})</div><span class="name">${i.from}→${i.caster}</span><article></article></div>`);for(const s in gainsBuffs)if(Object.hasOwnProperty.call(gainsBuffs,s)){const n=gainsBuffs[s];if("heal"===i.type&&("healBuffs"===s||"hotBuffs"==s)||"damage"===i.type&&("keigenBuffs"===s||"HPBuffs"==s))for(const t in n[e.line[7]]){let c="";"keigenBuffs"===s&&(!keigenBuffs[t].physics&&"physics"===i.damageType||!keigenBuffs[t].magic&&"magic"===i.damageType)&&(c="invalid"),Object.hasOwnProperty.call(n[e.line[7]],t)&&$(a).find("article").append(`<div class="buffs"><img class="${c}" src="https://cafemaker.wakingsands.com/i/${status[parseInt(t,16)].url}"><div class="from"><p>${n[e.line[7]][t].name}</p><p class="name">${n[e.line[7]][t].from}</p></div></div>`)}else if("damage"===i.type&&"enemyKeigenBuffs"===s)for(const s in n[e.line[3]]){let t="";(!enemyKeigenBuffs[s].physics&&"physics"===i.damageType||!enemyKeigenBuffs[s].magic&&"magic"===i.damageType)&&(t="invalid"),Object.hasOwnProperty.call(n[e.line[3]],s)&&$(a).find("article").append(`<div class="buffs"><img class="${t}" src="https://cafemaker.wakingsands.com/i/${status[parseInt(s,16)].url}"><div class="from"><p>${n[e.line[3]][s].name}</p><p>${n[e.line[3]][s].from}</p></div></div>`)}}$(`#${i.type}${s?"Party":""}`).append(a),window.scrollBy(0,$("main")[0].clientHeight)}if("26"!==e.line[0]||"4"!==e.line[7].substring(0,1)&&e.line[7]!==charID&&!inparty(e.line[7]))if("30"===e.line[0]&&(keigenBuffs[e.line[2]]||HPBuffs[e.line[2]]||healBuffs[e.line[2]]||hotBuffs[e.line[2]]||enemyKeigenBuffs[e.line[2]])&&("4"===e.line[7].substring(0,1)||e.line[7]===charID||inparty(e.line[7]))){for(const s in gainsBuffs)if(Object.hasOwnProperty.call(gainsBuffs,s)){const i=gainsBuffs[s];i[e.line[8]]&&i[e.line[8]].loses([e.line[2]])}}else"21"!==e.line[0]&&"22"!==e.line[0]||(inparty(e.line[6])&&s(e,!0),e.line[6]===charID&&s(e,!1));else{function i(s){gainsBuffs[s]||(gainsBuffs[s]={}),gainsBuffs[s][e.line[8]]||(gainsBuffs[s][e.line[8]]=new keigen),gainsBuffs[s][e.line[8]].gains(e.line[2],e.line[3],e.line[6])}keigenBuffs[e.line[2]]&&i("keigenBuffs"),HPBuffs[e.line[2]]&&i("HPBuffs"),healBuffs[e.line[2]]&&i("healBuffs"),hotBuffs[e.line[2]]&&i("hotBuffs"),enemyKeigenBuffs[e.line[2]]&&i("enemyKeigenBuffs")}}function getDamage(e){function s(){switch(e[8].substr(e[8].length-3,1)){case"1":return"暴击";case"2":return"直击";case"3":return"直暴!!";default:return""}}function i(){let s=e[9].padStart(8,"0");if("4"!==s[4])a.value=parseInt(s.substring(0,4),16);else{let e="0x"+s.substring(2,4),i="0x"+s.substring(6,8);a.value=parseInt(i.substring(2,4)+s.substring(0,2)+(e-i).toString(16).toUpperCase(),16)}}let a={type:"other",damageType:null,damageEffect:"",skillName:e[5],skillID:e[4],value:null,from:null,caster:null};return"26"===e[0]?(a.from=e[6],a.caster=e[8]):"21"!==e[0]&&"22"!==e[0]||(a.from=e[3],a.caster=e[7]),/^.{0,7}1$/.test(e[8])?(a.type="damage",a.damageType="dodge",a.damageEffect=""):/^(.{0,7}([356]|33)|.{0,5}[1-3].{2})$/.test(e[8])?(a.type="damage",a.damageType="physics",a.damageEffect=s()):/^.{0,3}5.[1-3].{4}$/.test(e[8])?(a.type="damage",a.damageType="magic",a.damageEffect=s()):/^.{0,3}6.[1-3].{4}$/.test(e[8])?(a.type="damage",a.damageType="darkness",a.damageEffect=s()):/^.{0,3}1.{0,3}4$/.test(e[8])?(a.type="heal",a.damageType="heal",a.damageEffect="暴击"):/^.{0,7}4$/.test(e[8])&&(a.type="heal",a.damageType="heal",a.damageEffect=""),i(),a}import{justGiveMe}from"../../resources/action.js";import{status}from"../../resources/status.js";class keigen{constructor(){}gains(){this[arguments[0]]={name:arguments[1],from:arguments[2]}}loses(){delete this[arguments[0]]}}let keigenBuffs={766:{physics:0,magic:1},"79f":{physics:1,magic:1},722:{physics:1,magic:1},"78e":{physics:1,magic:1},"72f":{physics:0,magic:1},751:{physics:1,magic:1},498:{physics:1,magic:1},"4b6":{physics:1,magic:1},351:{physics:1,magic:1},"12b":{physics:1,magic:1},"13d":{physics:0,magic:1},753:{physics:0,magic:1},"4b3":{physics:0,magic:1},"4ab":{physics:1,magic:0},"4a9":{physics:1,magic:1},730:{physics:1,magic:1},"2eb":{physics:1,magic:1},"49a":{physics:1,magic:1},"4a7":{physics:1,magic:1},"4a":{physics:1,magic:1},59:{physics:1,magic:1},740:{physics:1,magic:1},496:{physics:1,magic:1},57:{physics:1,magic:1},"2df":{physics:1,magic:1},199:{physics:1,magic:1},52:{physics:1,magic:1},"32a":{physics:1,magic:1},811:{physics:1,magic:1},"72c":{physics:1,magic:1},"2ea":{physics:0,magic:1},728:{physics:1,magic:1},"72a":{physics:1,magic:1},"4d0":{physics:1,magic:1},"49b":{physics:1,magic:1}},HPBuffs={"5b1":{},"77d":{},129:{},345:{},"2d7":{},757:{},"4c2":{},761:{},a8:{},790:{},"1e8":{}},healBuffs={57:{},"4b2":{},66:{},751:{},"13d":{},753:{},724:{},"2d6":{},778:{},"34d":{},"4c3":{}},hotBuffs={"72b":{},"9e":{},96:{},"12b":{},350:{},"34f":{},"13b":{},752:{},344:{},343:{},54:{},760:{}},enemyKeigenBuffs={"4b3":{physics:0,magic:1},"4ab":{physics:1,magic:0},"4a9":{physics:1,magic:1},"09":{physics:1,magic:0}},party=[],charID="",gainsBuffs={},duration="";addOverlayListener("ChangePrimaryPlayer",e=>{charID=e.charID.toString(16).toUpperCase()}),addOverlayListener("PartyChanged",e=>{party=e.party}),addOverlayListener("ChangeZone",()=>wipe()),addOverlayListener("onPartyWipe",()=>wipe()),addOverlayListener("CombatData",e=>duration=e.Encounter.duration),addOverlayListener("LogLine",e=>handle(e)),startOverlayEvents(),$("#damageParty").hide(),$("#heal").hide(),$("#healParty").hide(),$("#other").hide(),$("#otherParty").hide(),$("#menu>div:first").css("color","#26c6da"),$("#menu>div").on("click",e=>{$("#damage").hide(),$("#damageParty").hide(),$("#heal").hide(),$("#healParty").hide(),$("#other").hide(),$("#otherParty").hide(),$("#"+e.currentTarget.title).show(),$("#menu>div").css("color","#fff"),$(e.currentTarget).css("color","#26c6da")}),$("html").on("contextmenu",()=>$(".name").css("filter","blur(2px)"===$(".name").css("filter")?"":"blur(2px)"));