"use strict";function matchWatch(e){e:for(let a=0;a<party.length;a++){const t=party[a];if(t.name===extractLog(e.line,"CasterName"))for(let t=0;t<watchingName[a].length;t++){let c=parseInt(extractLog(e.line,"AbilityID"),16);for(const e in compareSameGroup)if(Object.hasOwnProperty.call(compareSameGroup,e)){const a=compareSameGroup[e];c===a[0]&&(c=a[1])}if(parseInt(watchingName[a][t])===c){let e=$(`tr:eq(${a})`).children()[t];if(""!==$(e).text()&&"?"!==$($(e).children()[0]).text())break;let c=watchingRecast[a][t]/10;$(e).css("opacity","1"),$(e).css("border",""),$(e).empty(),$(e).append($("<article></article>").text(c--)),$($(e).children()[0]).css("background-color","rgba(27,27,27,0.5)");let r=setInterval(()=>{$($(e).children()[0]).text(c--),(-1===c||flagFinish)&&(clearInterval(r),$($(e).children()[0]).css("background-color",""),$(e).text(""))},1e3);break e}}}}function addIcon(){clearIcon();for(let e=0;e<8;e++)if(e<party.length){$(`tr:eq(${e})`).css("background-color","rgba(0,0,0,0.5)");for(let a=0;a<10;a++)try{watchingName[e][a]=watch[party[e].job][9-a],watchingRecast[e][a]=action[party[e].job][watch[party[e].job][9-a]][5],$($($("tbody").children()[e]).children()[a]).css("background-image",`url(https://cafemaker.wakingsands.com/i/${action[party[e].job][watch[party[e].job][9-a]][1]})`);let t=action[party[e].job][watch[party[e].job][9-a]][3],c=$($("tbody").children()[e]).children()[a];99!==maxSync&&(t<=minSync?$(c).css("opacity","1"):minSync<t&&t<=maxSync&&80!=minSync&&($(c).append($("<article></article>").text("?")),$(c).css("opacity","0.8"))),clearInterval(timerSync)}catch{}}}function clearIcon(){$("tr").css("background-color",""),$("td").css("background-image",""),$("td").css("opacity","0.2"),$("td").text("")}import{checkLog,Comparison,extractLog}from"../../resources/logLineProcessing.min.js";import{partySort}from"../../resources/partyList.min.js";import{action}from"../../resources/action.min.js";import{quest}from"../../resources/quest.min.js";let charName,party,sortRuleAll,rangeSize=30,spacingHorizontal=3,spacingVertical=5,watchingName=Array(8),watchingRecast=Array(8);for(let e=0;e<8;e++)watchingName[e]=["","","","","","","","","",""],watchingRecast[e]=[0,0,0,0,0,0,0,0,0,0];let watch,minSync=1,maxSync=99,flagFinish=!1;watch=null==localStorage.getItem("setWatch")?{1:["","","","","","","7535","7548","7533",""],2:["","","","","","","7549","7542","7541",""],3:["","","","","","","7535","7548","7533",""],4:["","","","","","","7549","7542","7541",""],5:["","","","","","","","","",""],6:["","","","","","","","","",""],7:["","","","","","","7560","","157",""],19:["20","7383","7531","17","3540","7385","7535","7548","7533","30"],20:["7395","","","","","65","7549","7542","7541","7396"],21:["7389","16464","7531","44","3552","7388","7535","7548","7533","43"],22:["85","","","","","","7549","7542","7541","3557"],23:["101","","","","","","7405","","7541","118"],24:["7432","3570","3571","7433","3569","","16536","7562","7561","140"],25:["3573","","","","","","7560","","157",""],26:["","","","","","","7560","","157",""],27:["3581","7427","","","","","7560","","7561","7423"],28:["166","188","3583","16542","16537","7434","16545","7562","7561","7436"],29:["","","","","","","7549","7542","7541",""],30:["2257","","","","","","7549","7542","7541","2258"],31:["2878","","","","","","16889","","7541",""],32:["7390","7393","7531","3636","3634","16471","7535","7548","7533","3638"],33:["16556","7439","16557","16553","3613","","16559","7562","7561","16552"],34:["16486","7499","","","","","7549","7542","7541",""],35:["7521","","","","","","7560","","7561","7520"],36:["11415","11411","11421","23280","23273","18320","7560","18305","7561","18317"],37:["16138","16161","7531","16148","16151","16160","7535","7548","7533","16152"],38:["16013","15998","","","","16015","16012","","7541",""]}:JSON.parse(localStorage.getItem("setWatch"));let compareSameGroup=[[16484,16486],[16485,16486],[16191,16192],[15998,0],[16193,15998],[16194,15998],[16195,15998],[16196,15998]];document.addEventListener("onOverlayStateUpdate",e=>{e.detail.isLocked?($("#readMe").hide(),$("body").css("background-color","rgba(0,0,150,0.0)")):($("#readMe").show(),$("body").css("background-color","rgba(0,0,150,0.2)"))}),$("table").css("border-spacing",`${spacingHorizontal}px ${spacingVertical}px`),$("td").css("width",`${rangeSize}px`),$("td").css("height",`${rangeSize}px`),addOverlayListener("LogLine",e=>{checkLog(e.line,"00",{MessageType:[Comparison.equal,"0839"],MessageText:[Comparison.matchRegex,"^.+(任务结束了。| has ended.|」の攻略を終了した。)$"]})||checkLog(e.line,"00",{MessageType:[Comparison.equal,"0039"],MessageText:[Comparison.matchRegex,"^进入了休息区。|You have entered a sanctuary.|レストエリアに入った！$"]})?(clearIcon(),flagFinish=!0,setTimeout(()=>{flagFinish=!1},1e3)):checkLog(e.line,"21",{Command:[Comparison.equal,"40000001"]})||checkLog(e.line,"21",{Command:[Comparison.equal,"40000006"]})?addIcon():(checkLog(e.line,"15",{})||checkLog(e.line,"16",{}))&&matchWatch(e)}),addOverlayListener("ChangePrimaryPlayer",e=>{charName=e.charName}),addOverlayListener("ChangeZone",e=>{try{null==quest[e.zoneName]?(minSync=1,maxSync=99):(minSync=quest[e.zoneName][0],maxSync=quest[e.zoneName][1])}catch{minSync=1,maxSync=99}}),addOverlayListener("PartyChanged",e=>{try{party=partySort(e.party,charName,sortRuleAll)}catch{party=[]}}),startOverlayEvents(),sortRuleAll=null==localStorage.getItem("setSortRule")?[21,32,37,19,24,33,28,22,20,34,30,25,27,36,35,23,31,38]:JSON.parse(localStorage.getItem("setSortRule")),setTimeout(()=>{try{addIcon()}catch{}},1e3),window.settingsWatch=function(){window.open("./settingWatch.html","_blank","width=200,height=300")};