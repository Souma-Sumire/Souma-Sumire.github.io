"use strict";function load(e,a=""){return loadItem(namespace,e,a)}function cha(e,a){api=load("logsAPI"),api?(zone=load("logsZone"),$.ajax({type:"GET",cache:!1,dataType:"json",url:`https://www.fflogs.com/v1/rankings/character/${encodeURIComponent(e)}/${encodeURIComponent(a)}/${getRegion(a)}?zone=${zone}&metric=${metric}&timeframe=${timeframe}&api_key=${api}`,success:e=>{$("#main").html(template(e)),$("#main").fadeIn(0),timer=setTimeout(()=>{$("#main").fadeOut(0)},5e3)},timeout:5e3,error:()=>{$("#main").html("查无此人"),$("#main").fadeIn(0),timer=setTimeout(()=>{$("#main").fadeOut(0)},5e3)}})):$("#readMe").append("不设置API怎么查？")}function template(e){for(let a=0;a<e.length;a++)100===e[a].difficulty&&delete e[a];return e.hidden?"此人隐藏了logs":(e.sort(function(e,a){return e.encounterID===a.encounterID?parseInt(a.percentile)-parseInt(e.percentile):e.encounterID===a.encounterID}),`\n    ${e.map(e=>`<p><img src="https://assets.rpglogs.com/img/ff/bosses/${e.encounterID}-icon.jpg" class="boss-icon">${per(e.percentile)}<img src="https://assets.rpglogs.com/img/ff/icons/actors.png?v=5" class="tiny-icon sprite actor-sprite-${e.spec.replace(/\s+/g,"")}"></p>`).join("")||"无logs"}\n    `)}function per(e){let a=Math.round(e),r="";return r=100==a?"artifact":99==a?"astounding":a>=95?"legendary":a>=75?"epic":a>=50?"rare":a>=25?"uncommon":"common",`<span class="rank-percent ${r}">${a}</span>`}import{loadItem}from"../../resources/localStorage.min.js";import{getRegion}from"../../resources/dataCenter.min.js";import{checkLog,Comparison,extractLog}from"../../resources/logLineProcessing.min.js";let timer,namespace="logs",api=load("logsAPI"),zone=load("logsZone"),server=load("logsServer","海猫茶屋"),metric="dps",timeframe="historical";$("#settings").on("click",()=>{window.open("./settings.html","_blank","width=300,height=350")}),$("#submit").on("click",()=>{cha($("#test-id").val(),$("#test-server").val())}),document.addEventListener("onOverlayStateUpdate",e=>{e.detail.isLocked?$("#readMe").hide():$("#readMe").show()});let regexServer={CN:/晨曦王座|沃仙曦染|宇宙和音|红玉海|萌芽池|神意之地|幻影群岛|拉诺西亚|拂晓之间|龙巢神殿|旅人栈桥|白金幻象|白银乡|神拳痕|潮风亭|琥珀原|柔风海湾|海猫茶屋|延夏|静语庄园|摩杜纳|紫水栈桥|梦羽宝境/,NA:/Adamantoise|Cactuar|Faerie|Gilgamesh|Jenova|Midgardsormr|Sargatanas|Siren|Behemoth|Excalibur|Exodus|Famfrit|Hyperion|Lamia|Leviathan|Ultros|Balmung|Brynhildr|Coeurl|Diabolos|Goblin|Malboro|Mateus|Zalera/,JP:/Aegis|Atomos|Carbuncle|Garuda|Gungnir|Kujata|Ramuh|Tonberry|Typhon|Unicorn|Alexander|Bahamut|Durandal|Fenrir|Ifrit|Ridill|Tiamat|Ultima|Valefor|Yojimbo|Zeromus|Anima|Asura|Belias|Chocobo|Hades|Ixion|Mandragora|Masamune|Pandaemonium|Shinryu|Titan/,EU:/Cerberus|Louisoix|Moogle|Omega|Ragnarok|Spriggan|Lich|Odin|Phoenix|Shiva|Zodiark|Twintania|초코보|모그리|카벙클|톤베리/};addOverlayListener("LogLine",e=>{function a(){cha(r.groups.name,r.groups.server?r.groups.server:server)}let r,o=e.line;checkLog(o,"00",{MessageType:[Comparison.equal,"0038"],MessageText:[Comparison.matchRegex,"^[lL]ogs .+$"]})?(r=extractLog(o,"MessageText").match(`^[lL]ogs (?<name>[^ ]+?)(?<server>${regexServer[getRegion(server)]})?$`),a()):checkLog(o,"00",{MessageType:[Comparison.matchRegex,"^2239|1039$"],MessageText:[Comparison.matchRegex,"^.+(加入了小队。|joins? the party.|がパーティに参加しました。)$"]})?(r=extractLog(o,"MessageText").match(`^(?<name>.+?)(?<server>${regexServer[getRegion(server)]})?(加入了小队。|joins? the party.|がパーティに参加しました。)$`),a()):checkLog(o,"00",{MessageType:[Comparison.equal,"0039"],MessageText:[Comparison.matchRegex,`^(加入了|You join |コンテンツ「)(?<name>[^ ]+?)(?<server>${regexServer[getRegion(server)]})?(组建的|'s party for |」、募集者)`]})&&(r=extractLog(o,"MessageText").match(`^(加入了|You join |コンテンツ「)(?<name>[^ ]+?)(?<server>${regexServer[getRegion(server)]})?(组建的|'s party for |」、募集者)`),a())}),startOverlayEvents();